(this.$WP=this.$WP||[]).push(["A6b--N",(e,t)=>{"use strict";var s,a,i,r,o,n,l,d,p,u,c,h,g,m,S,D,v,f,y,N,E,L,_,C,I,O={seeAllLinks:!1,titles:!1,tagTranslations:!1,maxAccommodations:!1,tooltips:!1},b=(e,t)=>{var s=new Date;s.setDate(s.getDate()+e),t.push(s.getFullYear()),t.push(s.getMonth()+1),t.push(s.getDate())},w=e=>{var{accommodationsByType:t,pageLocations:s,isSearchComplete:a,sponsoredListingData:i,searchKey:r}=e,o=s.reduce((e,s)=>(e[s.locationName]={crossSells:s.crossSellTypes.map(e=>t[e]),locationName:s.locationName,locationOrder:s.locationOrder},e),{});return{pageLocations:s,locationMap:o,isSearchComplete:a,sponsoredListingData:i,searchKey:r}},A=[10,1e3,1e3,1e3,1e3,1500,1500,1500,2e3,2e3,2e3],T=()=>{var e,t;if("undefined"==typeof window)return O;var s=o().getState();return null==s||null==(e=s.page)||null==(t=e.crossSells)?void 0:t.uiAssets},q=e=>((e,t,s)=>t&&e&&t[e]?t[e]:s)(e,T().titles,a(g,{id:"p13n_you_may_also_like"})),x=e=>{var t=T(),{tooltips:s}=t;return s&&e&&s[e]||null},k=e=>{var t=T(),{seeAllLinks:s}=t;return((e,t,s)=>t&&e&&t[e]?t[e]:s)(e,s,null==s?void 0:s.default)};return[()=>{m=class extends s{constructor(e){super(e),O=e.data}render(){return null}},y=i({data:(e,t)=>{var s=t("/data/1.0/crosssellaccommodations/comparisongridcrosssellsuiassets/");return e=>{var{data:t,loading:a}=s.get();return a||!t?{}:{data:t}}},actions:{}})(m),S=class extends s{constructor(e){super(e),this.props.updateCrossSellEndpointData(this.props.data)}render(){return null}},N=i({data:(e,t)=>{var s=t("/data/1.0/crosssellaccommodations/comparisongridcrosssells");return e=>{var{data:t,loading:a}=s.get();return a||!t?{loading:!0}:e.page.crossSells.updatingResults?{updatingXSellResults:!0}:{data:w(t)}}},actions:{updateCrossSellEndpointData:r.page.hotelreview.setCrossSellsEndpointResults}})(S),E={module:"hr_xsell_skeleton",action:"xsell_show"},L={module:"hr_xsell_skeleton",action:"xsell_collapse"},_={module:"hr_xsell_skeleton",action:"xsell_remains_hidden"},D=class{constructor(e=h){this.trackEventAjax=void 0,this.displayStates=void 0,this.previousResults=void 0,this.shouldShowIncompleteResults=void 0,this.calculateDisplayStates=(e,t,s=!1)=>{for(var{accommodationsByType:a}=e,i=function(e,t){if(null==e)return{};var s,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)s=r[a],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,["accommodationsByType"]),r={},o=Object.keys(a),n=0;n<o.length;n++){var l=o[n],d=a[l],p=!1;this.displayStates[l]||(this.displayStates[l]=c.HIDDEN,p=!0);var u=this.displayStates[l],h=d.accommodations.length>0,g=d.isOverallComplete,m=void 0;if(s){var S=this.shouldShowIncompleteResults[l];m=this.getTimeoutStateTransition(u,g,S)}else m=this.getNextDisplayStateTransition(u,h,g,t,p);m.updateWithNewData&&(this.displayStates[l]=m.displayState),r[l]=Object.assign({},d,{},m)}var D=Object.assign({accommodationsByType:r},i);return this.previousResults=D,D},this.calculateTimeoutStates=()=>this.calculateDisplayStates(this.previousResults,0,!0),this.transition=(e,t)=>({displayState:e,updateWithNewData:t}),this.fromHidden=(e,t,s)=>e?(this.trackEventAjax(E),this.transition(c.SHOWING,!0)):t?(s&&this.trackEventAjax(_),this.transition(c.HIDDEN,!1)):(this.trackEventAjax(E),this.transition(c.LOADING,!0)),this.fromLoading=(e,t)=>e?this.transition(c.SHOWING,!0):t?(this.trackEventAjax(L),this.transition(c.HIDDEN,!0)):this.transition(c.LOADING,!1),this.fromShowing=(e,t,s)=>e?this.transition(c.SHOWING,!0):t?(this.trackEventAjax(L),this.transition(c.HIDDEN,!0)):1===s?this.transition(c.LOADING,!0):this.transition(c.SHOWING,!1),this.getNextDisplayStateTransition=(e,t,s,a,i)=>{switch(e){case c.HIDDEN:return this.fromHidden(t,s,i);case c.LOADING:return this.fromLoading(t,s);default:return this.fromShowing(t,s,a)}},this.getTimeoutStateTransition=(e,t,s=!0)=>{if(e===c.SHOWING){if(t||s)return this.transition(c.SHOWING,!1)}else e===c.LOADING&&this.trackEventAjax(L);return this.transition(c.HIDDEN,e!==c.HIDDEN)},this.trackEventAjax=e,this.displayStates={},this.shouldShowIncompleteResults={n:!0,c:!0,m:!0}}},v=class extends s{constructor(e){super(e),this.displayManager=void 0,this.pollingDelay=void 0,this.pollingTimedOut=()=>{this.props.urlData.requestNumber;var e=this.displayManager.calculateTimeoutStates(),t=w(e);this.props.updateCrossSellEndpointData(t)},this.timerContainer=new p,this.displayManager=new D,this.pollingDelay=A}componentDidMount(){this.props.skipOnLoadSearch||this.fetchCrossSellData()}componentDidUpdate(e){this.urlParamsChanged(e.urlData)&&!this.props.updatingXSellResults&&this.fetchCrossSellData()}urlParamsChanged(e){var t=this.props.urlData;return e.requestNumber!==t.requestNumber||e.stayDates!==t.stayDates||e.guests!==t.guests||e.detailId!==t.detailId||e.configuration!==t.configuration||e.requestCaller!==t.requestCaller||!d(e.filters,t.filters)}fetchCrossSellData(){var{urlData:e}=this.props;(e=>!!(e.detailId&&e.stayDates&&e.guests))(e)?((e,t=1e4)=>Promise.race([fetch(e,{method:"GET",header:{"Content-Type":"application/json"},credentials:"same-origin"}),new Promise((e,s)=>setTimeout(()=>s(new Error("timeout")),t))]))(((e,t)=>{var s=new URLSearchParams;if(s.append("rn",String(e.requestNumber)),s.append("stayDates",e.stayDates),s.append("guestInfo",e.guests),s.append("csc",e.configuration),s.append("rc",e.requestCaller),e.sponsoredListingData){var a=Object.assign({},e.sponsoredListingData);delete a.debugData,s.append("sld",JSON.stringify(a))}return e.requestNumber>t.length&&s.append("ifp",""),e.searchKey&&s.append("sk",e.searchKey),e.pageLoadUid&&s.append("puid",e.pageLoadUid),e.paramSeqId&&s.append("paramSeqId",String(e.paramSeqId)),e.filters&&s.append("ft",JSON.stringify(e.filters)),`/data/1.0/crosssellaccommodations/${e.detailId}?${s.toString()}`})(e,this.pollingDelay)).then(e=>{if(e.ok||e.status>=200&&e.status<300)return e;var t=`ResponseStatus: ${e.status} Invalid results from server: ${JSON.stringify(e)}`;return 400===e.status&&(t="Will stop polling. "+t),Promise.reject(new Error(t))}).then(e=>e.json()).then(e=>{var t,s=this.displayManager.calculateDisplayStates(e,this.props.urlData.requestNumber);s.sponsoredListingData&&s.sponsoredListingData.debugData&&(t=s.sponsoredListingData.debugData,window.__SP_DEBUG_EVENTS__=window.__SP_DEBUG_EVENTS__||[],t.forEach(e=>window.__SP_DEBUG_EVENTS__.push(e)),globalThis.require("ta/Core/TA.FireEvent").fireEvent("sp_debug_refresh"));var a=w(s);this.props.updateCrossSellEndpointData(a),a.isSearchComplete||this.triggerPoll()}).catch(e=>{var t;(null==e||null==(t=e.message)?void 0:t.startsWith("Will stop polling."))||this.triggerPoll()}):JSON.stringify(e)}triggerPoll(){var e={poll:this.props.poll,pollingDelay:this.pollingDelay,requestNumber:this.props.urlData.requestNumber,loading:!1,complete:!1,timedOut:this.pollingTimedOut};JSON.stringify(e),u(e,this.timerContainer)}render(){return null}},C=n((e,t)=>{return Object.assign({},t,{urlData:(s=e,a=t,i={detailId:a.featuredAccommodation,requestNumber:s.page.crossSells.requestNumber,configuration:a.configuration,requestCaller:a.requestCaller,filters:a.filters},((e,t,s)=>{var a,i,r,o,n,l,d=t.travelerInfo&&t.travelerInfo.hotels;if(d)e.stayDates=d.stayDates,e.guests=d.guests,e.paramSeqId=d.paramSeqId||0;else{var p=[];b(1,p),b(2,p),e.stayDates=p.join("_"),e.guests="1_1",e.paramSeqId=0}e.requestNumber>1&&(e.searchKey=null==t||null==(a=t.page)||null==(i=a.crossSells)||null==(r=i.endpointResults)?void 0:r.searchKey),s.sponsoredListingsEnabled&&(1===e.requestNumber?e.sponsoredListingData={}:e.sponsoredListingData=(null==t||null==(o=t.page)||null==(n=o.crossSells)||null==(l=n.endpointResults)?void 0:l.sponsoredListingData)||{}),t.tracking&&t.tracking.uid&&(e.pageLoadUid=t.tracking.uid)})(i,s,a),i),updatingXSellResults:e.page.crossSells.updatingResults});var s,a,i},{poll:r.page.hotelreview.crossSellsPoll,updateCrossSellEndpointData:r.page.hotelreview.setCrossSellsEndpointResults})(v),e("WaitForPageLocation$1",f=class extends s{static getDerivedStateFromProps(e,t){return!t.didWeLoadContainer&&e.didALocationRegister?(s=e.featuredAccommodation,a=e.xsellConfig,i=e.setUIAssets,r=e.filters,s&&fetch(((e,t,s)=>{var a=`/data/1.0/crosssellaccommodations/${e}/uiAssets/${t}`,i=new URLSearchParams;s&&i.append("ft",JSON.stringify(s));var r=i.toString();return r?`${a}?${r}`:a})(s,a,r),{method:"GET",header:{"Content-Type":"application/json"},credentials:"same-origin"}).then(e=>{if(e.ok)return e;throw JSON.stringify(e),new Error(e.statusText)}).then(e=>e.json()).then(e=>{i(e)}),{didWeLoadContainer:!0}):null;var s,a,i,r}constructor(e){super(e);var t="locationPhotoDirectLink"===e.requestCaller,s=l("t4b_hr_xsell_sponsored_slot_0_display")&&!t;this.state={didWeLoadContainer:!1,sponsoredListingsEnabled:s,serverSideSponsoredHotelSelectionEnabled:s}}render(){var e=null;if(this.props.didALocationRegister&&this.state.didWeLoadContainer){var t={configuration:this.props.xsellConfig,featuredAccommodation:this.props.featuredAccommodation,requestCaller:this.props.requestCaller?this.props.requestCaller:"hotelReview",sponsoredListingsEnabled:this.state.sponsoredListingsEnabled,serverSideSponsoredHotelSelectionEnabled:this.state.serverSideSponsoredHotelSelectionEnabled,skipOnLoadSearch:this.props.skipOnLoadSearch,filters:this.props.filters};e=a(C,t)}return e}}),I=n((e,t)=>Object.assign({},t,{didALocationRegister:!t.wait&&e.page.crossSells.atLeastOneLocationRegistered,featuredAccommodation:e.route.detail||e.page.detailId}),{setUIAssets:r.page.hotelreview.setUIAssets})(f),e({ComparisonGridDataLoader:N,UiAssetLoader:y,WaitForPageLocation:I,getSeeAllUrlForCrossSellType:k,getTitleForCrossSellType:q,getTooltipForCrossSellType:x,getUIAssets:T})},[e=>(s=e.Component,a=e.createElement),e=>i=e.bind,e=>(r=e.actions,o=e.getStore),e=>n=e.connect,e=>l=e.featureIsEnabled,e=>d=e.default,e=>(p=e.TimerContainer,u=e.setTimer),e=>c=e.DisplayState,e=>h=e.default,e=>g=e.default]]},["cDcdfi","RiHMo-","aunxON","h74DsO","-i3PJS","YwNsO_","FHZ_Dz","-XCXc8","Jk5sjx","0DsHEV"]]);
