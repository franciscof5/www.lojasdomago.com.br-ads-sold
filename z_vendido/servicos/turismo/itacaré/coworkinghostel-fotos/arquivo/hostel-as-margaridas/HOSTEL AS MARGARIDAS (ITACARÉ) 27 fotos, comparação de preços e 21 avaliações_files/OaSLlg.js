(this.$WP=this.$WP||[]).push(["OaSLlg",(e,i)=>{"use strict";var t,s,r,n,o,a,d,_,l,c=(e,i,t)=>{fetch("/data/1.0/tap/recordEvent",{method:"POST",headers:{"content-type":"application/json","x-requested-by":window.JS_SECURITY_TOKEN},credentials:"same-origin",body:JSON.stringify({eventType:t,requestGuid:e,externalId:i})}).then(e=>(e.ok||s.error("Did not get an ok. got: "+e.statusText),e)).catch(e=>{s.error("Error sending TripAds click event: "+e.message)})},p=(e,i)=>{c(e,i,"CLICKED")},g=(e,i)=>{c(e,i,"CLICKED_UNPAID")},u=(e,i)=>{c(e,i,"IMPRESSED")},m=(e,i,t,s,r)=>{var{sponsoredListing:n}=e,a={};n&&(a={placement_slot_name:n.placement_slot_name,location_id:e.id,sponsored_type:n.sponsored_type,opportunity_uid:n.opportunity_uid,sl_line_item_id:n.sl_line_item_id,page_geo_id:i,chosen_location_id:e.id,listing_key:e.listingKey,trip_ads_select_guid:n.trip_ads_select_request_guid,trip_ads_id:n.trip_ads_id}),o(t,s,Object.assign({},a,{},r))},k=(e,{auth:i,meta:t},s)=>{var{sponsoredListing:r}=e;if(r){var o={is_member:i.isMember,device_type:t.device.userAgentCategory?t.device.userAgentCategory.toLowerCase():"",locationId:e.id,slot:r.placement_slot_name,trip_ads_select_guid:r.trip_ads_select_request_guid,listing_key:e.listingKey};n(s,o)}},v=(e,i)=>{e.trip_ads_select_request_guid&&i(e.trip_ads_select_request_guid,e.opportunity_uid||"")},E=e=>{if(e){var i=document.getElementById("SP_PARTNER_NOTIFICATION_IFRAME");i||((i=document.createElement("iframe")).setAttribute("id","SP_PARTNER_NOTIFICATION_IFRAME"),i.setAttribute("style","position: absolute; visibility: hidden; right: 0; bottom: 0; width: 1px; height: 1px"),d(_.ALL,()=>{document.body&&i&&document.body.appendChild(i)})),i.src=e}},f=(e,{route:i},t,r,n,o)=>{var{sponsoredListing:a}=e;if(a){var d={area:a.placement_slot_name,click_type:t,dest:r,from:i.page,impression_key:a.impression_key,is_backfill:!0,listing_key:e.listingKey,location_id:e.id,sl_line_item_id:a.sl_line_item_id,trip_ads_id:a.trip_ads_id,tt_placement:a.tt_placement,auction_offer_key:n,gosox:a.gosox};fetch(o?"/SponsoredListingCommerce/1.0/increment_click_metric":"/SponsoredListingCommerce/1.0/click",{method:"POST",headers:{"content-type":"application/json","x-requested-by":window.JS_SECURITY_TOKEN},credentials:"same-origin",body:JSON.stringify(d)}).then(e=>(e.ok||s.debug("Did not get an ok. got: "+e.statusText),e)).catch(e=>{s.error("Error sending commerce click: "+e.message)})}};return[()=>{e("SponsoredListingTrackingEventHandlers",l=class{constructor(){this.visibleHandledHotels=new Set}clickHandler(e){var{sponsoredListing:i}=e;if(i){var s=a().getState();((e,i)=>{var{sponsoredListing:t}=e;t&&m(e,i,"action","paid_backup_sponsored_listing_click",{ik:t.impression_key,tt_placement:t.tt_placement})})(e,s.page.geoId),k(e,s,r.HOTELS_SP_CLICK),(e=>{var i=new Date;i.setTime(i.getTime()+1e4);var s={expires:i};t.set("sponsOppId",e.opportunity_uid,s),t.set("sponsLineItem",e.sl_line_item_id,s)})(i),f(e,s,"HR","Hotel_Review",null,!1),E(i.partner_notification_url),v(i,p)}}visibleHandler(e){var{sponsoredListing:i}=e;if(i&&!this.visibleHandledHotels.has(e.id)){this.visibleHandledHotels.add(e.id);var t=a().getState();((e,i)=>{m(e,i,"impression","paid_backup_sponsored_listing_displayed",{})})(e,t.page.geoId),k(e,t,r.HOTELS_SP_IMPRESSION),E(i.partner_impression_notification_url),v(i,u)}}clearVisibleHistory(){this.visibleHandledHotels.clear()}offerClickHandler(e,i){var{sponsoredListing:t}=e;if(t){var s=a().getState();((e,i,t)=>{var s=i.isInstantBook?"paid_backup_sponsored_ib_click":"paid_backup_sponsored_meta_click";globalThis.require&&window.require(["trjs!commerce/offerclick"],r=>{var n=function(e,i){if(null==e)return{};var t,s,r={},n=Object.keys(e);for(s=0;s<n.length;s++)t=n[s],i.indexOf(t)>=0||(r[t]=e[t]);return r}(r.expandToken(i.offerClickToken),["url"]);m(e,t,"action",s,n)})})(e,i,s.page.geoId);var r=((e,i)=>{if(globalThis.require){var{slot:t}=window.require("trjs!commerce/offerclick").expandToken(i.offerClickToken);return!!e&&"DISCOVERY_META_PREFERENCE"===e.sponsored_type&&"1"===t}return!1})(t,i),n="DISCOVERY_META_PREFERENCE"!==t.sponsored_type||r,o=(e=>{if(globalThis.require){var{ttAOK:i}=window.require("trjs!commerce/offerclick").expandToken(e.offerClickToken);return i}return""})(i);n&&f(e,s,i.isInstantBook?"IB":"META",i.provider,o,r),v(t,n?p:g)}}}),e({SponsoredListingTrackingEventHandlers:l,logTripAdsClickEvent:p,logTripAdsClickUnpaidEvent:g,logTripAdsImpressionEvent:u,notifyPartner:E})},[e=>t=e.default,e=>s=e.default,e=>(r=e.holisticEvents,n=e.trackHolisticEvent,o=e.trackEventWithContext),e=>a=e.getStore,e=>(d=e.requestConsent,_=e.CategoriesEnum)]]},["vmXh3M","4LU1Ax","Jk5sjx","aunxON","lMO0v3"]]);
